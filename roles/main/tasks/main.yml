- name: Ensure the .config folder exists and has the right permissions
  file: "path={{ home }}/.config state=directory mode=0755 owner={{ user }}"
  become: yes
  become_user: "{{ user }}"

- name: Ensure the dotfiles repo is cloned
  git:
    repo: https://github.com/Emigre/dotfiles.git
    version: master
    dest: "{{ home }}/dotfiles"
    update: no
    accept_hostkey: yes

- name: Symlink the dotfiles
  file:
    src: "{{ item }}"
    dest: "{{ home }}/{{ item | basename }}"
    state: link
  with_fileglob:
    - ".*"

- name: Ensure the scripts repo is cloned
  git:
    repo: https://github.com/Emigre/scripts.git
    version: master
    dest: "{{ home }}/scripts"
    update: no
    accept_hostkey: yes

- name: Ensure the code folder exists and has the right permissions
  file: "path={{ home }}/code state=directory mode=0755 owner={{ user }}"
  become: yes
  become_user: "{{ user }}"

- name: Ensure the envs folder exists and has the right permissions
  file: "path={{ home }}/envs state=directory mode=0755 owner={{ user }}"
  become: yes
  become_user: "{{ user }}"

- name: Ensure there is a .h_config file
  file: "path={{ home }}/.h_config state=touch mode=0644 owner={{ user }}"
  become: yes
  become_user: "{{ user }}"
  changed_when: false
